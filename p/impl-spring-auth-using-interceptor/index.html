<!DOCTYPE html>
<html lang="ko-KR" class="bg-transparent ">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Sitemap -->
	<link rel="sitemap" href="/sitemap.xml">
	<!-- RSS -->
	<link rel="alternate" type="application/rss+xml" href="/feed/posts.xml">
	<!-- Favicon -->
	<link rel="icon" type="image/x-icon" href="/favicon.ico">
	<!-- Google Fonts -->
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
	<!-- Codeblock theme -->
	<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-lucario.css" /> -->
	<!-- Flex Search -->
	<script defer src="https://rawcdn.githack.com/nextapps-de/flexsearch/0.7.2/dist/flexsearch.bundle.js"></script>

	<title data-hk="0-0">어노테이션과 인터셉터로 인증 구현하기</title><meta data-hk="0-1" name="description" content="스프링 시큐리티를 사용하지 않고 어노테이션과 인터셉터를 사용하여 인증 전략을 구현하는 방법에 대해 기술합니다."><meta data-hk="0-2" name="robots" content="index,follow"><meta data-hk="0-3" property="og:title" content="어노테이션과 인터셉터로 인증 구현하기"><meta data-hk="0-4" property="og:description" content="스프링 시큐리티를 사용하지 않고 어노테이션과 인터셉터를 사용하여 인증 전략을 구현하는 방법에 대해 기술합니다."><script>let configTheme = "auto";

		(function () {
			/* theme 설정이 'system'인 경우는 prefers-color-scheme 미디어 쿼리를 인식하여 설정한다 */
			if (configTheme === " system") {
				const htmlEl = document.getElementsByTagName('html')[0]; /* 시스템 테마가 다크이면 */ if
					(window.matchMedia("(prefers-color-scheme: dark)").matches) { htmlEl.classList.add("dark"); } /* 그 외엔 지정 안함 */
			} /*
	theme 설정이 'auto' 인 경우는 브라우저 localStorage에 저장된 값이 있는지 확인하고, 있으면 그 값을 없으면 'light' 로 설정한다. */ else if
				(configTheme === "auto") {
					const theme = window.localStorage.getItem("theme"); const
						htmlEl = document.getElementsByTagName('html')[0]; (theme) && htmlEl.classList.add(theme); console.log({ theme });
			} /*
	theme 설정이 'light' 혹은 'dark' 인 경우는 astro에서 처리한다. */ })(); </script>
<link rel="stylesheet" href="/assets/19767c6b.fdf359ee.css" /><script type="module">const{classList:e}=document.documentElement,A=e.add.bind(e);A("jpeg");A("png");const g=(B,d)=>{const a=new Image;a.src=`data:image/${B};base64,${d}`,a.onload=A(B)};g("webp","UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==");g("avif","AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");
</script></head>

<link rel="stylesheet" href="/assets/19767c6b.fdf359ee.css" /><script type="module">const{classList:e}=document.documentElement,A=e.add.bind(e);A("jpeg");A("png");const g=(B,d)=>{const a=new Image;a.src=`data:image/${B};base64,${d}`,a.onload=A(B)};g("webp","UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==");g("avif","AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");
</script><body class="w-full px-5 lg:px-0 overflow-y-scroll dark:bg-slate-900 dark:text-gray-50">
	<main class="w-full">
		<div class="max-w-3xl w-full mx-auto px-4 md:px-3 lg:px-0">
			<header class="py-5 w-full flex flex-row items-center justify-between">
	<h1 class="m-0 text-2xl">
		<a href="/" aria-label="Home">
			<span>tololo://</span>
		</a>
	</h1>
	<nav class="flex-none flex flex-row gap-2">

		<a href="/p/about/" class="px-4 py-2 inline-flex flex-row items-center justify-center gap-2 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:bg-slate-700 text-gray-900 dark:text-gray-100" aria-label="About">
			About
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em">
				<path fill="none" d="M0 0h24v24H0z"></path>
				<path fill="currentColor" d="M7.291 20.824L2 22l1.176-5.291A9.956 9.956 0 0 1 2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10a9.956 9.956 0 0 1-4.709-1.176zm.29-2.113l.653.35A7.955 7.955 0 0 0 12 20a8 8 0 1 0-8-8c0 1.334.325 2.618.94 3.766l.349.653-.655 2.947 2.947-.655zM7 12h2a3 3 0 0 0 6 0h2a5 5 0 0 1-10 0z"></path>
			</svg>
		</a>
		<astro-island uid="1PmkRx" component-url="/ThemeButton.35d3495e.js" component-export="default" renderer-url="/client.4ca19528.js" props="{&quot;config&quot;:[0,{&quot;baseurl&quot;:[0,&quot;https://yunu7067.github.io&quot;],&quot;title&quot;:[0,&quot;tololo://&quot;],&quot;description&quot;:[0,&quot;YUNU7067&#39;s log&quot;],&quot;locale&quot;:[0,{&quot;languageCode&quot;:[0,&quot;ko-KR&quot;]}],&quot;author&quot;:[0,{&quot;name&quot;:[0,&quot;YUNU7067&quot;],&quot;comment&quot;:[0,&quot;끊임없이 공부하는 사람이 되고싶은 개발자.&quot;]}],&quot;avatar&quot;:[0,{&quot;enabled&quot;:[0,true],&quot;src&quot;:[0,&quot;/public/assets/profile/avatar.jpeg&quot;]}],&quot;social&quot;:[1,&quot;[[0,{\&quot;identifier\&quot;:[0,\&quot;github\&quot;],\&quot;name\&quot;:[0,\&quot;GitHub\&quot;],\&quot;url\&quot;:[0,\&quot;https://github.com/yunu7067/\&quot;]}],[0,{\&quot;identifier\&quot;:[0,\&quot;discord\&quot;],\&quot;name\&quot;:[0,\&quot;Discord\&quot;],\&quot;url\&quot;:[0,\&quot;https://discordapp.com/users/태규#6493/\&quot;]}],[0,{\&quot;identifier\&quot;:[0,\&quot;npmjs\&quot;],\&quot;name\&quot;:[0,\&quot;Npmjs\&quot;],\&quot;url\&quot;:[0,\&quot;https://www.npmjs.com/~yunu7067\&quot;]}],[0,{\&quot;identifier\&quot;:[0,\&quot;email\&quot;],\&quot;name\&quot;:[0,\&quot;Email\&quot;],\&quot;url\&quot;:[0,\&quot;mailto:yunu7067@gmail.com\&quot;]}]]&quot;],&quot;theme&quot;:[0,&quot;auto&quot;],&quot;comments&quot;:[0,{&quot;enabled&quot;:[0,true],&quot;provider&quot;:[0,&quot;giscus&quot;],&quot;giscus&quot;:[0,{&quot;repo&quot;:[0,&quot;yunu7067/yunu7067.github.io&quot;],&quot;repoId&quot;:[0,&quot;MDEwOlJlcG9zaXRvcnkzNTMzNjU1MjQ&quot;],&quot;category&quot;:[0,&quot;giscus&quot;],&quot;categoryId&quot;:[0,&quot;DIC_kwDOFQ_uFM4CADJ2&quot;],&quot;mapping&quot;:[0,&quot;pathname&quot;],&quot;reactionsEnabled&quot;:[0,&quot;1&quot;],&quot;emitMetadata&quot;:[0,&quot;0&quot;],&quot;inputPosition&quot;:[0,&quot;bottom&quot;],&quot;lang&quot;:[0,&quot;ko&quot;],&quot;loading&quot;:[0,&quot;lazy &quot;],&quot;lightTheme&quot;:[0,&quot;light&quot;],&quot;darkTheme&quot;:[0,&quot;dark_dimmed&quot;]}]}]}]}" ssr="" client="load" before-hydration-url="data:text/javascript;charset=utf-8,//[no before-hydration script]" opts="{&quot;name&quot;:&quot;ThemeButton&quot;,&quot;value&quot;:true}"><button data-hk="0-0" class="px-4 py-2 inline-flex flex-row items-center justify-center gap-2 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:bg-slate-700 text-gray-900 dark:text-gray-100" aria-label="dark mode toggle"><svg data-hk="0-1-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em"><path fill="none" d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></button></astro-island>
		<a href="/series/" class="px-4 py-2 inline-flex flex-row items-center justify-center gap-2 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:bg-slate-700 text-gray-900 dark:text-gray-100" aria-label="Series">
			<!-- Series -->
			<svg data-hk="0-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em"><path fill="none" d="M0 0h24v24H0z"></path><path fill="currentColor" d="M20.083 15.2l1.202.721a.5.5 0 0 1 0 .858l-8.77 5.262a1 1 0 0 1-1.03 0l-8.77-5.262a.5.5 0 0 1 0-.858l1.202-.721L12 20.05l8.083-4.85zm0-4.7l1.202.721a.5.5 0 0 1 0 .858L12 17.65l-9.285-5.571a.5.5 0 0 1 0-.858l1.202-.721L12 15.35l8.083-4.85zm-7.569-9.191l8.771 5.262a.5.5 0 0 1 0 .858L12 13 2.715 7.429a.5.5 0 0 1 0-.858l8.77-5.262a1 1 0 0 1 1.03 0zM12 3.332L5.887 7 12 10.668 18.113 7 12 3.332z"></path></svg>
		</a>
		<a href="/search/" class="px-4 py-2 inline-flex flex-row items-center justify-center gap-2 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:bg-slate-700 text-gray-900 dark:text-gray-100" aria-label="Search">
			<!-- Search -->
			<svg data-hk="0-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1em" height="1em"><path fill="none" d="M0 0h24v24H0z"></path><path fill="currentColor" d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15z"></path></svg>
		</a>
	</nav>
</header>
			<div class="layout astro-3AN7XC2S">
	<article class="content astro-3AN7XC2S">
		<div class="astro-3AN7XC2S">
			<header class="pb-8 mb-8 flex flex-col items-center justify-center text-center  astro-3AN7XC2S">
				
				<p class="m-0 astro-3AN7XC2S">2022. 7. 4.</p>
				<h1 class="m-0 mb-1 text-4xl font-bold leading-normal astro-3AN7XC2S">어노테이션과 인터셉터로 인증 구현하기</h1>
				<ul data-hk="0-0" class="flex flex-row gap-2 flex-wrap"><li data-hk="0-1-0" class="py-0.5 px-2.5 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 text-sm text-slate-800"><a href="/tag/Spring">#<!--#-->Spring<!--/--></a></li><li data-hk="0-2-0" class="py-0.5 px-2.5 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 text-sm text-slate-800"><a href="/tag/Spring Boot">#<!--#-->Spring Boot<!--/--></a></li><li data-hk="0-3-0" class="py-0.5 px-2.5 rounded-md bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 dark:text-slate-200 text-sm text-slate-800"><a href="/tag/Kotlin">#<!--#-->Kotlin<!--/--></a></li></ul>
			</header>
			<main id="article-container" class="astro-3AN7XC2S">
				<details class="bg-gray-200 dark:bg-gray-700 rounded-sm py-7 px-10 mb-8 astro-NL6IKFTU" aria-label="Table of Contents" open>
	<summary class="text-xl font-bold astro-NL6IKFTU">목차</summary>
	<div class="mt-2.5 astro-NL6IKFTU">
		<div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth1 astro-NL6IKFTU">
			<a href="#서론" class="astro-NL6IKFTU">서론</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth1 astro-NL6IKFTU">
			<a href="#흐름도" class="astro-NL6IKFTU">흐름도</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth1 astro-NL6IKFTU">
			<a href="#구현" class="astro-NL6IKFTU">구현</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth2 astro-NL6IKFTU">
			<a href="#어노테이션" class="astro-NL6IKFTU">어노테이션</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth3 astro-NL6IKFTU">
			<a href="#authentication" class="astro-NL6IKFTU">@Authentication</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth3 astro-NL6IKFTU">
			<a href="#roleguard" class="astro-NL6IKFTU">@RoleGuard</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth2 astro-NL6IKFTU">
			<a href="#인터셉터" class="astro-NL6IKFTU">인터셉터</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth3 astro-NL6IKFTU">
			<a href="#firebaseauthinterceptor" class="astro-NL6IKFTU">FirebaseAuthInterceptor</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth3 astro-NL6IKFTU">
			<a href="#roleguardinterceptor" class="astro-NL6IKFTU">RoleGuardInterceptor</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth2 astro-NL6IKFTU">
			<a href="#인터셉터-configuration-구현" class="astro-NL6IKFTU">인터셉터 Configuration 구현</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth2 astro-NL6IKFTU">
			<a href="#실제-사용" class="astro-NL6IKFTU">실제 사용</a>
		</div><div class="toc text-gray-800 dark:text-gray-300 mb-1.5 depth1 astro-NL6IKFTU">
			<a href="#참고문헌" class="astro-NL6IKFTU">참고문헌</a>
		</div>
	</div>
</details><h1 id="서론">서론</h1><blockquote>
<p>모든 코드는 <strong>Kotlin</strong> 으로 작성되었습니다.</p>
</blockquote><p>파이어베이스는 인증, 데이터베이스, 메시징 등을 제공하는 구글의 서비스 중 하나입니다. 무형문화연구원에서 인증에 이 파이어베이스를 사용하기로 했고, 프론트엔드(리액트 기반)에서는 이 인증 전략을 사용하는 것이 매우 수월하였습니다. 하지만 백엔드에서는 그렇게 쉬운 작업이 아니라는 걸 깨닫는 데에는 그리 오래 걸리지 않았습니다. 처음에는 Spring Security와 통합하여 사용하려 했으나, 통합하는데 어려움이 컸고 역할 체크가 필요한 작업에도 마찬가지로 매우 어려운 일이었습니다. 필터에서 동작하는 Spring Security대신 성능에 조금 손해가 있더라도 원하는 기능을 쉽게 구현할 수 있는 인터셉터를 사용하여 인증을 구현하였습니다.</p><h1 id="흐름도">흐름도</h1><p><style >
    

    .astro-imagetools-picture-656F23B5 {
      --opacity: 1;
      --z-index: 0;
    }

    
            .astro-imagetools-picture-656F23B5 img {
              z-index: 1;
              position: relative;
            }
          

    .astro-imagetools-picture-656F23B5::after {
      inset: 0;
      content: "";
      left: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      transition: opacity 1s;
      opacity: var(--opacity);
      z-index: var(--z-index);
    }
  
        .astro-imagetools-picture-656F23B5 img {
          object-fit: cover;
          object-position: 50% 50%;
        }

        .astro-imagetools-picture-656F23B5::after {
          background-size: cover;
          background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVRIiZ1Wi5KaMBT1/7+u7dp2t7u66lRAQeWRF3mdTsIqQcCCd8aByM3h3NycExYYCWut/7moKgHGZO//+7ExBosxMKBNJISBUt55NjwHw4CdidaiKh2oHWTo4jp211GG16Q8l3hZ7vHrdwJSqQ7AUCzGHlwncS4RxQxJwqCU6TG6jwdrCGitIQT3lRttIATr5cwCrOsa1howKhHtL1ivIkRR7rse5k0GJIT6raCUBecaZUn9VUrzHKAQop1kgfxS93KeA7TA4cDwscoRx6TZTcE+fQgYbpmQYZ4LxLEEqXQv7wFgk9Q2xQEacM6hpARjNaRsJTi/ZK5QFgyMUT9WqoZSMwDtjZ2FrC32e4rNtoQQGtYAx0OB87kBD7X+3zV0QYnC69sRf95PoER7tqtVgt3uBK0nKsUGknIKYcyCEA2tmzKDTOcZg7EYU4hSjRHUtUaW5b5srU1nWSYz5LzxPmcGcZRjuz166XVNdgZDESoEQFHwnsNM7nIX0K2hRZo60LbEyX5oA1NwYGWpsfwZ4dv3DX68/EWati4ziyGlrOk0t/jcFHj/yLBaX/wLngIUwRoyppCdgLJsuv5Uyfyry3UtQSmF0c1LrhKcfATYgKELrdVNu1oZ3+2nSuZfDI+HHOkx9/fJgWP9WXjlPAJdhGD3gElSIEsrv4nX6zNe39Kba0/yQxv4YBicMy9BRsPDfrDiYYZlSfznh1tLQohnbLRFFB098OySXZlZWvpz+RpVVWO53CHLyCig+xT5B5i2QLcJ71XJAAAAAElFTkSuQmCC");
          background-position: 50% 50%;
        }
      </style><picture
    
    class="astro-imagetools-picture astro-imagetools-picture-656F23B5"
    style="position: relative; display: inline-block; ; max-width: 100%; height: auto;"
    ><source
            srcset="/assets/flowchart@320w.4cd7174e.webp 320w, /assets/flowchart@839w.cc08ec16.webp 839w, /assets/flowchart@1283w.8fc62fdf.webp 1283w, /assets/flowchart@1654w.4555e890.webp 1654w, /assets/flowchart@1950w.ffbb1445.webp 1950w, /assets/flowchart@2173w.87e41372.webp 2173w, /assets/flowchart@2321w.d30a3ecd.webp 2321w, /assets/flowchart@2395w.745fc566.webp 2395w"
            sizes="(min-width: 2395px) 2395px, 100vw"
            width="2395"
            height="3601"
            type="image/webp"
            
          />
<img
    
    src="/assets/flowchart@2395w.f637d1b0.png"
    alt="FlowChart"
    srcset="/assets/flowchart@320w.04a19119.png 320w, /assets/flowchart@839w.2ce9909f.png 839w, /assets/flowchart@1283w.2678eab3.png 1283w, /assets/flowchart@1654w.7f0a2236.png 1654w, /assets/flowchart@1950w.bbe91b5b.png 1950w, /assets/flowchart@2173w.0773597f.png 2173w, /assets/flowchart@2321w.d0727d44.png 2321w, /assets/flowchart@2395w.f637d1b0.png 2395w"
    sizes="(min-width: 2395px) 2395px, 100vw"
    width="2395"
    height="3601"
    loading="lazy"
    decoding="async"
    class="astro-imagetools-img"
    style="display: inline-block; overflow: hidden; vertical-align: middle; ; max-width: 100%; height: auto;"
    onload="parentElement.style.setProperty('--z-index', 1);parentElement.style.setProperty('--opacity', 0);"
  />
  </picture>
</p><h1 id="구현">구현</h1><h2 id="어노테이션">어노테이션</h2><p>어노테이션으로는 <code>@Authentication</code>과 <code>@RoleGuard</code>를 구현하였습니다. <code>@Authentication</code>은 로그인만 체크를 하는 어노테이션이며, <code>@RoleGuard</code>는 로그인 된 사용자의 역할을 필터링하는 어노테이션입니다. <code>@RoleGuard</code>은 무조건 <code>@Authentication</code>이 있어야 하며, <code>@Authentication</code>뒤에 작성하여야 합니다.</p><h3 id="authentication">@Authentication</h3><p><code>@Authentication</code> 어노테이션은 매개변수 없이 작성만 하도록 구현하였습니다. 이하는 클래스 위에 붙은 어노테이션들에 대한 설명입니다.</p><p><code>@Target</code>은 이 어노테이션을 사용할 수 있는 타깃을 지정합니다. <code>AnnotationTarget.FUNCTION</code>이라 했으므로 이 어노테이션은 함수(Function)에서만 사용 가능합니다. 클래스나 매개변수 등에서는 사용이 불가능합니다. (<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.annotation/-annotation-target/">AnnotationTarget</a> 문서 참조)</p><p><code>@Retention</code>은 이 어노테이션이 컴파일 클래스에도 유지되는지, 런타임 시 리플렉션으로 표현되는지 관한 것으로 자바에서는 <code>SOURCE|CLASS|RUNTIME</code> 이렇게 세 가지가 있습니다. <code>SOURCE</code>로 설정할 경우 컴파일 레벨에서 이 어노테이션은 버려지고, <code>CLASS</code>로 설정할 경우 유지는 되지만 JVM에서 실행될 때 포함되지는 않습니다. 마지막으로 <code>RUNTIME</code>으로 설정할 경우 런타임까지 코드가 살아있으며 실행됩니다. 코틀린에서는 이름이 조금 다른데, <code>CLASS</code>가 <code>BINARY</code>로 바뀌어 <code>SOURCE|BINARY|RUNTIME</code>로 사용합니다. 동작은 동일합니다. (<a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.annotation/-annotation-retention/">AnnotationRetention</a> 문서 참조)</p><p><code>@MustBeDocumented</code>은 public API 문서에 포함되는지 여부를 나타냅니다.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* Authentication.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@Target</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">AnnotationTarget</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">FUNCTION</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">@Retention</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">AnnotationRetention</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">RUNTIME</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">@MustBeDocumented</span></span>
<span class="line"><span style="color: #FF7B72">annotation</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Authentication</span></span></code></pre><h3 id="roleguard">@RoleGuard</h3><p><code>@RoleGuard</code> 어노테이션에서는 에서는 여러 역할을 체크할 수 있도록 배열 형식의 매개변수를 추가하였습니다. 클래스 위의 어노테이션은 위와 동일합니다.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* RoleGuard.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@Target</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">AnnotationTarget</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">FUNCTION</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">@Retention</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">AnnotationRetention</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">RUNTIME</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">@MustBeDocumented</span></span>
<span class="line"><span style="color: #FF7B72">annotation</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">RoleGuard</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> role</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Array</span><span style="color: #FF7B72">&lt;</span><span style="color: #79C0FF">String</span><span style="color: #FF7B72">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span></code></pre><h2 id="인터셉터">인터셉터</h2><p>실질적인 인터셉터 동작은 이 인터셉터 클래스에 구현됩니다. 모두 스프링 Bean 컨테이너에 등록되어야 하므로 <code>@Component</code>를 붙여줍니다.</p><h3 id="firebaseauthinterceptor">FirebaseAuthInterceptor</h3><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* FirebaseAuthInterceptor.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@Component</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">FirebaseAuthInterceptor</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> firebaseService</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">FirebaseService</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HandlerInterceptor</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">preHandle</span><span style="color: #C9D1D9">(request</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HttpServletRequest</span><span style="color: #C9D1D9">, response</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HttpServletResponse</span><span style="color: #C9D1D9">, handler</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Any</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Boolean</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (handler </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HandlerMethod</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            handler.getMethodAnnotation(Authentication::</span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">.java)?.</span><span style="color: #79C0FF">let</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> token </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> request.getHeader(</span><span style="color: #A5D6FF">&quot;Authentication&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">?:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResponseStatusException</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">HttpStatus</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">UNAUTHORIZED</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;로그인이 필요한 서비스입니다.&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> uid </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> firebaseService.getUid(token)</span></span>
<span class="line"><span style="color: #C9D1D9">                request.setAttribute(</span><span style="color: #A5D6FF">&quot;firebase_uid&quot;</span><span style="color: #C9D1D9">, uid)</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (handler </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResourceHttpRequestHandler</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResponseStatusException</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">HttpStatus</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">INTERNAL_SERVER_ERROR</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;서버에 오류가 발생했습니다. 관리자에게 문의해주세요.&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><h3 id="roleguardinterceptor">RoleGuardInterceptor</h3><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* RoleGuardInterceptor.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@Component</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">RoleGuardInterceptor</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> userRepository</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">UserRepository</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HandlerInterceptor</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">preHandle</span><span style="color: #C9D1D9">(request</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HttpServletRequest</span><span style="color: #C9D1D9">, response</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HttpServletResponse</span><span style="color: #C9D1D9">, handler</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Any</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Boolean</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (handler </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">HandlerMethod</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            handler.getMethodAnnotation(RoleGuard::</span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">.java)?.</span><span style="color: #79C0FF">let</span><span style="color: #C9D1D9"> { roleGuard </span><span style="color: #FF7B72">-&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> uid</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> request.getAttribute(</span><span style="color: #A5D6FF">&quot;firebase_uid&quot;</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">String</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> user</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">User</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> userRepository.findByUid(uid)</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">?:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResponseStatusException</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">HttpStatus</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">GONE</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;사용자를 찾을 수 없습니다.&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (user.hasRole(roleGuard.role)) </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResponseStatusException</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">HttpStatus</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">FORBIDDEN</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;권한이 없습니다.&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (handler </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResourceHttpRequestHandler</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">throw</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ResponseStatusException</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">HttpStatus</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">INTERNAL_SERVER_ERROR</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;서버에 오류가 발생했습니다.&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><p><code>getMethodAnnotation</code> 메서드로 <code>@RoleGuard</code> 어노테이션이 존재하는 지 확인한 후, 이후 람다식을 실행합니다. 먼저 이전 <code>FirebaseAuthInterceptor</code>가 정상적으로 실행되어 유저를 찾았다면 request의 속성에 firebase_uid라는 이름으로 값이 담겨있습니다. 만약 이 값이 없거나 있지만 사용자를 찾ㅇ르 수 없는 경우 <code>ResponseStatusException</code>를 사용하여 <code>410 Gone</code> 상태코드를 반환합니다. 사용자가 있었으면 역할(role) 체크를 진행합니다. 위에서 말한 것 처럼 역할은 배열로 들어옵니다. 이 배열에 해당하는 역할이 존재하는지 체크한 후, 일치하는 역할이 없는 경우 <code>401 Forbidden</code> 상태코드를 반환합니다. 만약 존재한다면 정상적으로 Controller를 실행합니다.</p><h2 id="인터셉터-configuration-구현">인터셉터 Configuration 구현</h2><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* InterceptorConfig.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@Configuration</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">InterceptorConfig</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> firebaseAuthInterceptor</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">FirebaseAuthInterceptor</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> roleGuardInterceptor</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">RoleGuardInterceptor</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">WebMvcConfigurer</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">override</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addInterceptors</span><span style="color: #C9D1D9">(registry</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">InterceptorRegistry</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        registry.addInterceptor(firebaseAuthInterceptor)</span></span>
<span class="line"><span style="color: #C9D1D9">        registry.addInterceptor(roleGuardInterceptor)</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><p><code>FirebaseAuthInterceptor</code> 인터셉터와 <code>RoleGuardInterceptor</code> 인터셉터를 등록시켜줍니다.</p><h2 id="실제-사용">실제 사용</h2><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">/* ScheduleApiController.kt */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">@RestController</span></span>
<span class="line"><span style="color: #FF7B72">@RequestMapping</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [</span><span style="color: #A5D6FF">&quot;/schedule&quot;</span><span style="color: #C9D1D9">])</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ScheduleApiController</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> scheduleService</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ScheduleService</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> calendarService</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">CalendarService</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">val</span><span style="color: #C9D1D9"> logger</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Logger</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">LoggerFactory</span><span style="color: #C9D1D9">.getLogger(this::</span><span style="color: #79C0FF">class</span><span style="color: #C9D1D9">.java)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@GetMapping</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">readSchedules</span><span style="color: #C9D1D9">()</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #FF7B72">&lt;</span><span style="color: #FFA657">Schedule</span><span style="color: #FF7B72">&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> scheduleService.getAll()</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@GetMapping</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;/{schedule_id}&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">readSchedule</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">@PathVariable</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;schedule_id&quot;</span><span style="color: #C9D1D9">) scheduleId</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Long</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    )</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Schedule</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> scheduleService.getScheduleById(scheduleId)</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@Authentication</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@RoleGuard</span><span style="color: #C9D1D9">([</span><span style="color: #A5D6FF">&quot;ADMINISTRATOR&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;RESEARCHER&quot;</span><span style="color: #C9D1D9">])</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@PostMapping</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createSchedule</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">@RequestBody</span><span style="color: #C9D1D9"> dto</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ScheduleDto</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">ScheduleCreateDto</span><span style="color: #C9D1D9">)</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Schedule</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> scheduleService.create(dto)</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@Authentication</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@RoleGuard</span><span style="color: #C9D1D9">([</span><span style="color: #A5D6FF">&quot;ADMINISTRATOR&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;RESEARCHER&quot;</span><span style="color: #C9D1D9">])</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">@PatchMapping</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;/{schedule_id}&quot;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">fun</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateSchedule</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">@PathVariable</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;schedule_id&quot;</span><span style="color: #C9D1D9">) scheduleId</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Long</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">@RequestAttribute</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&quot;firebase_uid&quot;</span><span style="color: #C9D1D9">) uid</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">@RequestBody</span><span style="color: #C9D1D9"> dto</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ScheduleDto</span><span style="color: #C9D1D9">.</span><span style="color: #FFA657">ScheduleUpdateDto</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    )</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">Schedule</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> scheduleService.updateById(scheduleId, dto)</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/* 후략 */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">@Authentication</span></span>
<span class="line"><span style="color: #FF7B72">@RoleGuard</span><span style="color: #C9D1D9">([</span><span style="color: #A5D6FF">&quot;ADMINISTRATOR&quot;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&quot;RESEARCHER&quot;</span><span style="color: #C9D1D9">])</span></span></code></pre><p>인증 체크와 역할 체크가 필요한 url에 위와 같은 어노테이션을 작성해주었습니다. 위의 경우 <strong>로그인이 필요</strong>하고 <strong>관리자와 연구원만 접근이 가능</strong>하게 됩니다.</p><h1 id="참고문헌">참고문헌</h1><ul>
<li><a href="https://kotlinlang.org/docs/annotations.html">Annotations | Kotlin</a></li>
<li><a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Status">HTTP 상태 코드 - HTTP | MDN</a></li>
</ul>
			</main>
		</div>
	</article>
</div>
			<div class="">
				<style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).load=a=>{(async()=>await(await a())())()};var a;{const l={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t)},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,i]=s;return e in l?l[e](i):void 0};customElements.get("astro-island")||customElements.define("astro-island",(a=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement?.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},i=this.querySelectorAll("template[data-astro-template]");for(const r of i)!r.closest(this.tagName)?.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove());for(const r of s)!r.closest(this.tagName)?.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML);const n=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,n,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}async connectedCallback(){window.addEventListener("astro:hydrate",this.hydrate),await import(this.getAttribute("before-hydration-url"));const s=JSON.parse(this.getAttribute("opts"));Astro[this.getAttribute("client")](async()=>{const e=this.getAttribute("renderer-url"),[i,{default:n}]=await Promise.all([import(this.getAttribute("component-url")),e?import(e):()=>()=>{}]);return this.Component=i[this.getAttribute("component-export")||"default"],this.hydrator=n,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},a.observedAttributes=["props"],a))}</script><astro-island uid="1SQeJw" component-url="/BlogViews.9b3d7b7e.js" component-export="default" renderer-url="/client.4ca19528.js" props="{&quot;namespace&quot;:[0,&quot;https://yunu7067.github.io&quot;],&quot;key&quot;:[0,&quot;/p/impl-spring-auth-using-interceptor/&quot;]}" ssr="" client="load" before-hydration-url="data:text/javascript;charset=utf-8,//[no before-hydration script]" opts="{&quot;name&quot;:&quot;BlogViews&quot;,&quot;value&quot;:true}"><div data-hk="0-0"><!--#-->loading...<!--/--> </div></astro-island>
			</div>
			<div class="my-5 px-4 sm:px-8 py-6 rounded-sm bg-gray-100 dark:bg-gray-800 flex flex-col-reverse sm:flex-row gap-4 shadow-sm">
	<div class="flex-auto flex flex-col">
		Author
		<h3 class="text-xl mb-1">@YUNU7067</h3>
		<p class="flex-auto font-light line-clamp-2">끊임없이 공부하는 사람이 되고싶은 개발자.</p>
	</div>
	<div class="flex-none">
		<div class="w-fit shadow-sm  overflow-hidden">
			<style >
    

    .astro-imagetools-picture-468D58D5 {
      --opacity: 1;
      --z-index: 0;
    }

    
            .astro-imagetools-picture-468D58D5 img {
              z-index: 1;
              position: relative;
            }
          

    .astro-imagetools-picture-468D58D5::after {
      inset: 0;
      content: "";
      left: 0;
      width: 100%;
      height: 100%;
      position: absolute;
      transition: opacity 1s;
      opacity: var(--opacity);
      z-index: var(--z-index);
    }
  
        .astro-imagetools-picture-468D58D5 img {
          object-fit: cover;
          object-position: 50% 50%;
        }

        .astro-imagetools-picture-468D58D5::after {
          background-size: cover;
          background-image: url("data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABwAF/8QAKBAAAgIABQMCBwAAAAAAAAAAAQMCBAAFBhEhBxJBFJETIiMxMlGx/8QAFQEBAQAAAAAAAAAAAAAAAAAAAwX/xAAcEQACAgIDAAAAAAAAAAAAAAAAAQIDBBETFDH/2gAMAwEAAhEDEQA/AELp6gXdD5LYsWa8XMRGEYmR3mR8vvxjSR6a1FhqvS+K5lcyqYmIyH3BI84HNDdQq+VaPrUmU3Mt0PjMSRL6cieR3Enf22xlaH1pepIs5XlKKtIXrgbJoX3yhKfBI3PjbgeMUqsmT1tgTqS8G0sRJ71gnuTPsmO08HYS/khiwPT6k5rlx9Lk8lrqQJ2m9QY1xJJLJkn8j+hwMWF7kQ+I/9k=");
          background-position: 50% 50%;
        }
      </style><picture
    
    class="astro-imagetools-picture astro-imagetools-picture-468D58D5"
    style="position: relative; display: inline-block; ; max-width: 100%; height: auto;"
    ><source
            srcset="/assets/avatar@145w.d313cc34.webp"
            sizes="(min-width: 145px) 145px, 100vw"
            width="145"
            height="104"
            type="image/webp"
            
          />
<img
    
    src="/assets/avatar@145w.339f66f7"
    alt="YUNU7067"
    srcset="/assets/avatar@145w.339f66f7.jpeg"
    sizes="(min-width: 145px) 145px, 100vw"
    width="145"
    height="104"
    loading="lazy"
    decoding="async"
    class="astro-imagetools-img"
    style="display: inline-block; overflow: hidden; vertical-align: middle; ; max-width: 100%; height: auto;"
    onload="parentElement.style.setProperty('--z-index', 1);parentElement.style.setProperty('--opacity', 0);"
  />
  </picture>

		</div>
	</div>
</div>
			<div id="blog-comment" class="giscus mt-12 mb-8"></div>

<script client:load src="https://giscus.app/client.js" data-repo="yunu7067/yunu7067.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzNTMzNjU1MjQ" data-category="giscus" data-category-id="DIC_kwDOFQ_uFM4CADJ2" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="ko" data-loading="lazy " crossorigin="anonymous" async>
	</script>
		</div>
	</main>

	<footer data-hk="0-0" class="w-full text-center py-4 px-2"><div class="max-w-3xl mx-auto text-gray-500 font-light">©YUNU7067, Built with Astro</div></footer>
</body></html>